<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</title>
  <style>
    body {
      font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #bc3030;
      color: #333;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      overflow-x: auto;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-top: 0;
    }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 6px; font-weight: bold; }
    input, select, button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background-color: #ffd13f;
      color: black;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s;
    }
    button:hover { background-color: #da8012; }

    .table-wrapper { 
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    table {
      width: 100%;
      min-width: 1300px;
      border-collapse: collapse;
      margin-top: 20px;
      table-layout: auto;
    }
    table th, table td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      vertical-align: top;
      white-space: normal;
      word-break: break-word;
      overflow-wrap: anywhere;
      hyphens: auto;
    }
    table th {
      background-color: #f9f9f9;
      font-weight: bold;
      line-height: 1.4;
      white-space: normal;
    }

    #adminTableContainer table th:first-child {
      white-space: nowrap;
    }
    .status {
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 4px;
      display: inline-block;
      white-space: nowrap;
    }
    .status.waiting { background-color: #28a745; color: #fff; }
    .status.received { background-color: #007bff; color: #fff; }
    .status.expiring { background-color: #ffa500; color: #fff; }
    .status.expired  { background-color: #dc3545; color: #fff; }

    input[type="date"], input[type="time"] {
      -webkit-appearance: none;
      appearance: none;
      height: 44px;
      padding: 10px 12px;
      font-size: 16px;
      line-height: 1.2;
    }
    input[type="date"]::-webkit-date-and-time-value,
    input[type="time"]::-webkit-date-and-time-value {
      text-align: left;
    }

    @media (max-width: 768px) {
      body { padding: 12px; }
      .container {
        padding: 16px;
        overflow-x: visible;
      }

      .form-group { margin-bottom: 12px; }

      #adminTableContainer {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 20px auto 0;
        width: 100%;
        max-width: 100%;
      }
      #adminTableContainer h2 {
        text-align: center;
        width: 100%;
        margin-bottom: 12px;
      }

      #adminTableContainer .table-wrapper {
        width: 100%;
        max-width: 100%;
        padding: 0;
        overflow: visible;
        display: flex;
        justify-content: center;
      }

      #adminTableContainer table {
        display: block;
        width: 100% !important;
        min-width: auto;
        max-width: 460px;
        margin: 0 auto;
        border-collapse: separate;
        border-spacing: 0;
      }
      
      #adminTableContainer thead { display: none; }
      #adminTableContainer tbody { display: block; width: 100%; }

      #adminTableContainer tbody tr {
        display: block;
        width: 100%;
        margin: 0 auto 14px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        padding: 12px 14px;
        box-sizing: border-box;
      }

      #adminTableContainer tbody td {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        border: none;
        border-bottom: 1px solid #eee;
        padding: 8px 0;
        text-align: left;
        white-space: normal;
        word-break: break-word;
        overflow-wrap: anywhere;
      }
      #adminTableContainer tbody td:last-child { border-bottom: none; }

      #adminTableContainer tbody td::before {
        content: attr(data-label);
        font-weight: 600;
        color: #666;
        margin-right: 8px;
        min-width: 130px;
        max-width: 130px;
        flex-shrink: 0;
        white-space: normal;
        word-break: break-word;
        line-height: 1.3;
      }

      #adminTableContainer td[data-label^="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û"] img,
      #adminTableContainer td[data-label*="Picture"] img {
        max-width: 72px;
        max-height: 72px;
        object-fit: cover;
      }

      #adminTableContainer td[data-label^="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"] .status,
      #adminTableContainer td[data-label*="Status"] .status {
        display: inline-block;
        padding: 6px 10px;
      }

      #adminTableContainer td[data-label^="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á"],
      #adminTableContainer td[data-label*="Reporter Details"] {
        flex-direction: column;
        align-items: stretch;
      }

      #adminTableContainer td[data-label^="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á"]::before,
      #adminTableContainer td[data-label*="Reporter Details"]::before {
        margin-bottom: 8px;
      }

      #adminTableContainer td[data-label^="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á"] > div,
      #adminTableContainer td[data-label*="Reporter Details"] > div {
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
        border-bottom: 1px solid #f0f0f0;
      }

      #adminTableContainer td[data-label^="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á"] > div:last-child,
      #adminTableContainer td[data-label*="Reporter Details"] > div:last-child {
        border-bottom: none;
      }

      #adminTableContainer td[data-label^="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á"] strong,
      #adminTableContainer td[data-label*="Reporter Details"] strong {
        color: #666;
        font-weight: 600;
        min-width: 100px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="section" id="searchSection">
      <h1>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢</h1>
      <div class="form-group">
        <label for="searchItemName">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á</label>
        <input type="text" id="searchItemName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤, ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
      </div>
      <div class="form-group">
        <label for="searchLocation">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
        <input type="text" id="searchLocation" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ SC3, ‡πÇ‡∏£‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ SC">
      </div>
      <div class="form-group">
        <label for="searchDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
        <input type="date" id="searchDate">
      </div>
      <div class="form-group">
        <label for="searchDetails">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
        <input type="text" id="searchDetails" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏µ‡∏î‡∏≥, ‡∏°‡∏µ‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î">
      </div>
      <button id="searchBtn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
      
      <div style="margin-top: 20px;">
        <a href="lost.html" style="text-decoration: none;">
          <button style="width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; background-color: #ffd13f; color: black; cursor: pointer; font-weight: bold; transition: background-color 0.2s;">
            ‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢
          </button>
        </a>
      </div>
    </div>

    <div id="adminTableContainer" style="margin-top:20px; display:none;">
      <h2>üìã ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h2>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
              <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á</th>
              <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
              <th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
              <th>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠/‡∏£‡∏∏‡πà‡∏ô</th>
              <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
              <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
              <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö</th>
              <th>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</th>
            </tr>
          </thead>
          <tbody id="adminTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const LAMBDA_SEARCH_URL = "https://vnzvfki24e5re2d6fh3k6bmq2a0ddolc.lambda-url.us-east-1.on.aws/";
    
    const searchButton = document.getElementById("searchBtn");
    const resultsContainer = document.getElementById("adminTableBody");
    const container = document.getElementById("adminTableContainer");
    
    // ‚úÖ Event Listener ‡∏û‡∏£‡πâ‡∏≠‡∏° Validate ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    searchButton.addEventListener("click", async function(e) {
      const itemName = document.getElementById("searchItemName").value.trim();
      const location = document.getElementById("searchLocation").value.trim();
      const date = document.getElementById("searchDate").value;
      const details = document.getElementById("searchDetails").value.trim();
    
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢
      if (!itemName && !location && !date && !details) {
        alert("‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤");
        return;
      }
    
      // ‡∏£‡∏ß‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
      const keyword = itemName || details;
    
      const payload = {
        keyword: keyword || '',
        location: location || '',
        date: date || '',
        moreDetails: details || ''
      };
    
      await fetchFromLambda(payload);
    });
    
    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Lambda ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    async function fetchFromLambda(payload) {
      const tbody = document.getElementById("adminTableBody");
      tbody.innerHTML = `<tr><td colspan="12" style="text-align:center; padding: 20px;">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</td></tr>`;
      container.style.display = "block";
      if(searchButton) searchButton.disabled = true;
    
      try {
        const response = await fetch(LAMBDA_SEARCH_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!response.ok) {
          const errData = await response.json().catch(() => ({ error: `HTTP ${response.status}` }));
          throw new Error(errData.error || `HTTP error! status: ${response.status}`);
        }
        const result = await response.json();
        renderAdminTable(result.items || []);
      } catch (error) {
        tbody.innerHTML = `<tr><td colspan="12" style="color:red; text-align:center; padding: 40px;">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</td></tr>`;
        container.style.display = "block";
      } finally {
        if(searchButton) searchButton.disabled = false;
      }
    }
    
    // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á LOST/FOUND
    function renderAdminTable(items) {
      const tbody = document.getElementById("adminTableBody");
      if (!tbody) return;
    
      items.sort((a, b) => (b.created_at || '').localeCompare(a.created_at || ''));
      container.style.display = 'block';
    
      if (items.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="12" style="text-align:center; padding: 40px; color:#b22222; font-weight:bold;">
              ‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
            </td>
          </tr>
        `;
        return;
      }
    
      tbody.innerHTML = items.map((item, index) => {
        let displayBrandInfo = item.brand || '-';
        const isFound = item.item_type === 'FOUND';
        const typeColor = isFound ? '#dcfce7' : '#fee2e2';
        const typeTextColor = isFound ? '#166534' : '#991b1b';
        const typeText = isFound ? '‡∏û‡∏ö‡∏Ç‡∏≠‡∏á' : '‡∏Ç‡∏≠‡∏á‡∏´‡∏≤‡∏¢';
    
        const statusMap = {
          '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô': { class: 'waiting', text: '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô' },
          '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß': { class: 'received', text: '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß' },
          '‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß': { class: 'expired', text: '‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' },
          '‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß': { class: 'waiting', text: '‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß' }
        };
        const statusInfo = statusMap[item.status] || { class: 'waiting', text: item.status || '-' };
    
        return `
          <tr>
            <td data-label="‡∏•‡∏≥‡∏î‡∏±‡∏ö">${index + 1}</td>
            <td data-label="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó">
              <span style="display:inline-block;padding:4px 8px;border-radius:4px;font-weight:600;background-color:${typeColor};color:${typeTextColor};">
                ${typeText}
              </span>
            </td>
            <td data-label="‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà">${item.category || "-"}</td>
            <td data-label="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û">
              ${item.image_url ? `<a href="${item.image_url}" target="_blank"><img src="${item.image_url}" alt="item" style="width:50px;height:50px;object-fit:cover;"></a>` : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}
            </td>
            <td data-label="‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠/‡∏£‡∏∏‡πà‡∏ô">${displayBrandInfo}</td>
            <td data-label="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">${item.details || "-"}</td>
            <td data-label="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà">${item.date || "-"}</td>
            <td data-label="‡πÄ‡∏ß‡∏•‡∏≤">${item.time || "-"}</td>
            <td data-label="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">${item.location || "-"}</td>
            <td data-label="‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á">
              <div style="font-size:0.875rem;">
                <div><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${item.reporter_name || '-'}</div>
                <div><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå:</strong> ${item.reporter_contact || '-'}</div>
                ${item.reporter_student_id ? `<div><strong>‡∏£‡∏´‡∏±‡∏™:</strong> ${item.reporter_student_id}</div>` : ''}
              </div>
            </td>
          </tr>
        `;
      }).join("");
    }
    
    // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Enter Search ‡∏ó‡∏∏‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå
    ['searchItemName', 'searchLocation', 'searchDate', 'searchDetails'].forEach(id => {
      const input = document.getElementById(id);
      if (input) {
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            searchButton.click();
          }
        });
      }
    });
    </script>    
</body>
</html>
